<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Gallery</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="gallery.css"/>
</head>
<body>
    <div class="navbar">
        <a href="mainpage.html" class="brand" style="text-decoration: none;">:D</a>
        <ul>
            <li><a href="clock.html">Clock</a></li>
            <li><a href="calendar.html">Calendar</a></li>
            <li><a href="upload.html">Image desktop</a></li>
            <li><a href="blog.html">Blogs</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="settings.html">Settings</a></li>
        </ul>
    </div>
    <div class="gallery-container">
        <div class="warning-container">
            <h2>Warning</h2>
            <p>This feature isn't working correctly right now. Currently, there aren't any suitable replacements for this feature, so it has been temporarily deprecated. You are still able to use it, but all the uploaded images/GIFs/videos are only saved if you use the same browser. Other people won't be able to see them. Despite all of that, I have found the decent alternative place to upload your post out there, please go to this page: <a href="http://users.smartgb.com/g/g.php?a=s&i=g19-01726-0d" target="_blank">guestbook!</a>.</p>
        </div>
        <div class="upload-form">
            <h3>Gallery uploader</h3>
            <input type="text" id="uploader-name" placeholder="Name">
            <input type="text" id="context" placeholder="Context of the image">
            <input type="file" id="image-input" accept="image/*,video/*">
            <button class="upload-button" onclick="uploadImage()">Upload image</button>
        </div>
        <div class="gallery-grid" id="gallery-grid"></div>
    </div>
    <script>
        const galleryGrid = document.getElementById('gallery-grid');
        const imageInput = document.getElementById('image-input');

        // Load items from local storage on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedGalleryItems = JSON.parse(localStorage.getItem('galleryItems')) || [];
            savedGalleryItems.forEach(item => {
                addGalleryItem(item.name, item.context, item.dataUrl, item.time);
            });

            const savedColor = localStorage.getItem('themeColor');
            if (savedColor) {
                document.body.style.backgroundColor = savedColor;
            }
        });

        function uploadImage() {
            const name = document.getElementById('uploader-name').value.trim();
            const context = document.getElementById('context').value.trim();
            const file = imageInput.files[0];

            if (!name || !context || !file) {
                return; // Ensures that name, context, and file are all provided
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const currentTime = new Date().toLocaleString('en-US', { timeZone: 'America/New_York' });
                addGalleryItem(name, context, e.target.result, currentTime);
                saveGalleryItem(name, context, e.target.result, currentTime);

                // Clear the form after successful upload
                document.getElementById('uploader-name').value = '';
                document.getElementById('context').value = '';
                imageInput.value = '';
            };
            reader.readAsDataURL(file);
        }

        function addGalleryItem(name, context, dataUrl, time) {
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item';

            let mediaElement;
            if (dataUrl.startsWith('data:image')) {
                mediaElement = document.createElement('img');
            } else if (dataUrl.startsWith('data:video')) {
                mediaElement = document.createElement('video');
                mediaElement.controls = true;
            }
            mediaElement.src = dataUrl;
            galleryItem.appendChild(mediaElement);

            const infoDiv = document.createElement('div');
            infoDiv.className = 'info';
            infoDiv.innerHTML = `<strong>Uploaded by:</strong> ${name}<br>
                                 <strong>Context:</strong> ${context}<br>
                                 <strong>Time:</strong> ${time}`;
            galleryItem.appendChild(infoDiv);

            galleryGrid.appendChild(galleryItem);
        }

        function saveGalleryItem(name, context, dataUrl, time) {
            const savedGalleryItems = JSON.parse(localStorage.getItem('galleryItems')) || [];
            savedGalleryItems.push({ name, context, dataUrl, time });
            localStorage.setItem('galleryItems', JSON.stringify(savedGalleryItems));
        }
    </script>
</body>
</html>