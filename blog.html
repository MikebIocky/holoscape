<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body, .navbar, .main-container {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Libre Franklin', sans-serif;
        }
        body {
            background-color: #f0f0f0;
            color: #000;
        }
        .navbar {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #000e80;
            border-bottom: 2px solid #000;
            box-shadow: 2px 2px 0px #000;
        }
        .navbar .brand {
            font-weight: bold;
            font-size: 1.5em;
            text-transform: uppercase;
            margin-right: 20px;
            color: #fff;
            text-decoration: none;
        }
        .navbar ul {
            list-style: none;
            display: flex;
            padding: 0;
            margin: 0;
        }
        .navbar ul li {
            margin-right: 15px;
        }
        .navbar ul li a {
            text-decoration: none;
            color: #fff;
            font-weight: 600;
            transition: color 0.3s;
        }
        .navbar ul li a:hover {
            color: #ffcc00;
        }
        .main-container {
            padding: 10px;
            max-width: 700px;
            margin: 20px auto;
            background: #ffffff;
            border: 2px solid #000;
            box-shadow: 3px 3px 0px #000;
        }
        .new-post {
            background: #f9f9f9;
            padding: 10px;
            border: 2px solid #000;
            box-shadow: 3px 3px 0px #000;
            margin-bottom: 15px;
        }
        .new-post input[type="text"], .new-post textarea, .new-post input[type="file"] {
            width: 100%;
            max-width: 400px;
            padding: 8px;
            margin-bottom: 10px;
            border: 2px solid #000;
            font-family: 'Libre Franklin', sans-serif;
            resize: none;
        }
        .new-post button {
            padding: 8px 16px;
            background: #000e80;
            color: #fff;
            border: 2px solid #000;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        .new-post button:hover {
            background: #003366;
        }
        .post {
            background: #ffffff;
            padding: 10px;
            margin-bottom: 15px;
            border: 2px solid #000;
            box-shadow: 3px 3px 0px #000;
        }
        .post .post-header {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        .post .post-content {
            margin-bottom: 8px;
            font-size: 1em;
            line-height: 1.4;
        }
        .post .post-image {
            max-width: 100%;
            height: auto;
            margin-bottom: 8px;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 0px #000;
        }
        .post-controls {
            display: flex;
            gap: 8px;
        }
        .post-controls button {
            background: none;
            border: none;
            cursor: pointer;
            color: #000e80;
            font-weight: bold;
            transition: color 0.3s;
            font-size: 0.9em;
        }
        .post-controls button:hover {
            color: #003366;
        }
        .reply-form {
            margin-top: 8px;
            padding: 8px;
            background: #f9f9f9;
            border: 2px solid #000;
            box-shadow: 3px 3px 0px #000;
        }
        .reply-form input[type="text"], .reply-form textarea {
            width: 100%;
            max-width: 400px;
            padding: 6px;
            margin-bottom: 8px;
            border: 2px solid #000;
            font-family: 'Libre Franklin', sans-serif;
            resize: none;
        }
        .reply-form button {
            padding: 6px 12px;
            background: #000e80;
            color: #fff;
            border: 2px solid #000;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        .reply-form button:hover {
            background: #003366;
        }
        .reply {
            margin-top: 8px;
            padding: 8px;
            border-left: 4px solid #ccc;
            background: #f1f1f1;
            box-shadow: 2px 2px 0px #000;
        }
        .reply strong {
            font-weight: bold;
        }
        .theme-selector {
            margin-bottom: 10px;
        }
        .theme-selector label {
            font-weight: bold;
            margin-right: 8px;
        }
        .theme-selector input[type="color"] {
            padding: 4px;
            border: 2px solid #000;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Apply saved theme color from localStorage
            const savedTheme = localStorage.getItem('themeColor');
            if (savedTheme) {
                document.body.style.backgroundColor = savedTheme;
            }
            loadPosts();
        });

        function changeThemeColor() {
            const themeColor = document.getElementById('theme-color').value;
            document.body.style.backgroundColor = themeColor;
            localStorage.setItem('themeColor', themeColor);
        }

        function addNewPost() {
            const newPostText = document.getElementById('new-post-text').value;
            const blogAuthor = document.getElementById('blog-author').value.trim() || 'anonymous';
            const newPostImage = document.getElementById('new-post-image').files[0];

            if (newPostText.trim() === '' && !newPostImage) return;

            let imageUrl = '';
            if (newPostImage) {
                // Save image to localStorage
                const reader = new FileReader();
                reader.onload = function(e) {
                    imageUrl = e.target.result;
                    const post = {
                        author: blogAuthor,
                        content: newPostText,
                        date: new Date().toLocaleString('en-US', { timeZone: 'America/New_York' }),
                        imageUrl: imageUrl,
                        replies: []
                    };
                    savePost(post);
                    renderPost(post);
                };
                reader.readAsDataURL(newPostImage);
            } else {
                const post = {
                    author: blogAuthor,
                    content: newPostText,
                    date: new Date().toLocaleString('en-US', { timeZone: 'America/New_York' }),
                    imageUrl: imageUrl,
                    replies: []
                };
                savePost(post);
                renderPost(post);
            }

            document.getElementById('new-post-text').value = '';
            document.getElementById('blog-author').value = '';
            document.getElementById('new-post-image').value = '';
        }

        function savePost(post) {
            const posts = JSON.parse(localStorage.getItem('posts')) || [];
            posts.push(post);
            localStorage.setItem('posts', JSON.stringify(posts));
        }

        function loadPosts() {
            const posts = JSON.parse(localStorage.getItem('posts')) || [];
            posts.forEach(post => renderPost(post));
        }

        function renderPost(post) {
            const postElement = document.createElement('div');
            postElement.className = 'post';

            const postHeader = document.createElement('div');
            postHeader.className = 'post-header';
            postHeader.textContent = `${post.author} - ${post.date}`;

            const postContent = document.createElement('div');
            postContent.className = 'post-content';
            postContent.textContent = post.content;

            postElement.appendChild(postHeader);
            postElement.appendChild(postContent);

            if (post.imageUrl) {
                const postImage = document.createElement('img');
                postImage.className = 'post-image';
                postImage.src = post.imageUrl;
                postElement.appendChild(postImage);
            }

            const postControls = document.createElement('div');
            postControls.className = 'post-controls';

            const likeButton = document.createElement('button');
            likeButton.textContent = 'like';
            likeButton.onclick = () => toggleLike(likeButton);

            const removeButton = document.createElement('button');
            removeButton.textContent = 'remove';
            removeButton.onclick = () => removePost(postElement, post);

            const replyButton = document.createElement('button');
            replyButton.textContent = 'reply';
            replyButton.onclick = () => showReplyForm(postElement, post);

            postControls.appendChild(likeButton);
            postControls.appendChild(removeButton);
            postControls.appendChild(replyButton);

            postElement.appendChild(postControls);

            const repliesContainer = document.createElement('div');
            repliesContainer.className = 'replies-container';
            post.replies.forEach(reply => {
                const replyElement = document.createElement('div');
                replyElement.className = 'reply';
                replyElement.innerHTML = `<strong>${reply.author}:</strong> ${reply.content}`;
                repliesContainer.appendChild(replyElement);
            });
            postElement.appendChild(repliesContainer);

            document.querySelector('.posts-container').prepend(postElement);
        }

        function toggleLike(button) {
            if (button.textContent === 'like') {
                button.textContent = 'liked';
                button.style.color = '#ff0000';
            } else {
                button.textContent = 'like';
                button.style.color = '#000e80';
            }
        }


        function showReplyForm(postElement, post) {
            let replyForm = postElement.querySelector('.reply-form');
            if (!replyForm) {
                replyForm = document.createElement('div');
                replyForm.className = 'reply-form';
                replyForm.innerHTML = `
                    <input type="text" class="reply-author" placeholder="your name">
                    <textarea class="reply-text" placeholder="write your reply..."></textarea>
                    <button onclick="addReply(this, '${post.date}')">reply</button>
                `;
                postElement.appendChild(replyForm);
            }
        }

        function addReply(button, postDate) {
            const replyForm = button.parentElement;
            const replyAuthor = replyForm.querySelector('.reply-author').value.trim() || 'anonymous';
            const replyText = replyForm.querySelector('.reply-text').value.trim();

            if (replyText === '') return;

            const posts = JSON.parse(localStorage.getItem('posts')) || [];
            const post = posts.find(p => p.date === postDate);
            const reply = {
                author: replyAuthor,
                content: replyText
            };
            post.replies.push(reply);
            localStorage.setItem('posts', JSON.stringify(posts));

            const replyElement = document.createElement('div');
            replyElement.className = 'reply';
            replyElement.innerHTML = `<strong>${reply.author}:</strong> ${reply.content}`;
            replyForm.parentElement.querySelector('.replies-container').appendChild(replyElement);

            replyForm.querySelector('.reply-author').value = '';
            replyForm.querySelector('.reply-text').value = '';
        }
    </script>
</head>
<body>
    <div class="navbar">
        <a href="mainpage.html" class="brand">:D</a>
        <ul>
            <li><a href="clock.html">clock</a></li>
            <li><a href="calendar.html">calendar</a></li>
            <li><a href="upload.html">upload works</a></li>
            <li><a href="blog.html">blogs</a></li>
            <li><a href="settings.html">settings</a></li>
        </ul>
    </div>
    <div class="main-container">
        <div class="theme-selector">
            <label for="theme-color">Select Theme Color:</label>
            <input type="color" id="theme-color" onchange="changeThemeColor()">
        </div>
        <div class="new-post">
            <input type="text" id="blog-author" placeholder="enter your name">
            <textarea id="new-post-text" placeholder="what's on your mind?"></textarea>
            <input type="file" id="new-post-image" accept="image/*">
            <button onclick="addNewPost()">post</button>
        </div>
        <div class="posts-container"></div>
    </div>
</body>
</html>